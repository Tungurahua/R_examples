---
title: "R at Ecologic Institute"
author: "Albrecht Gradmann"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: ioslides_presentation
---

```{r setup,include=FALSE}
library(knitr)
library(png)
library(grid)
opts_chunk$set(message=FALSE,results='hide')
opts_knit$set(root.dir=normalizePath('../'))
```

```{r,cache=FALSE,eval=T,echo=FALSE}
read_chunk('Example01/NUTS2choropletes_script.R')
```




## Introduction  
**R** is a free software environment for statistical computing and graphics. In this presentation I will show how to use some of R **libraries** to download data from Eurostat using the **SDMX** dataformat.



## What is R 
```{r whatisR, echo=FALSE}
img <- readPNG("resources/RStudio.png")
grid.raster(img)
```

## Use of libraries 

Before going through the things, we will run libraries
```{r libraries,results='hide',tidy=FALSE,message=FALSE}
<<libraries>>
```


## What is SDMX

```{r sdmx, echo=FALSE}
img <- readPNG("resources/sdmx.png")
grid.raster(img)
```



# Getting data
## Eurostat Databrowser
```{r eurostat, echo=FALSE}
img <- readPNG("resources/Eurostat_REST.PNG")
grid.raster(img)
```

## RJSDMX methods
We download the dataset from Eurostat
```{r get_data,message=FALSE,tidy=FALSE,cache=TRUE}
<<get_data>>
```

```{r convert_data,message=FALSE,tidy=FALSE,cache=TRUE}
<<convert_data>>
```

## Inspecting  the data-frame
```{r show_tsDf, results='markup',echo=2:3}
tsDf2 <- tsDf[c("FREQ","UNIT","SEX","GEO","TIME","OBS")] 
head(tsDf2, n = 4)
str(tsDf2, width=50, strict.width = "cut")
```

## Downloading geospatial data
```{r download_shp,message=FALSE,tidy=F,cache=TRUE}
<<download_shp>>
```

## Processing geospatial data
```{r Read_shp,message=FALSE,tidy=F,cache=TRUE,warning=FALSE,results='hide'}
<<Read_shp>> 
```

## Inspecting the raw maps
```{r plot_shp,message=FALSE,tidy=F,cache=TRUE,echo=FALSE,results='hide'}
plot(eurMap) 
```

## Merge and order data
```{r convert_shp,message=FALSE,tidy=F,warning=FALSE,results='hide'}
<<convert_shp>>
```

```{r merge_data,message=FALSE,tidy=F,warning=FALSE}
<<merge_data>>
```


# Plotting
## Creating a first draft
```{r first_plot,fig.show='hide'}
<<first_plot>>
```

## Creating a first draft
```{r first_plot2,echo=FALSE,fig.show='asis'}
<<first_plot>>
```


## Putting Europe into focus

```{r put_EU_in_focus,fig.show='hide'}
<<put_EU_in_focus>>
```

## Putting Europe into focus

```{r put_EU_in_focus2,echo=FALSE,fig.show='asis'}
<<put_EU_in_focus>>
```


## Several other steps

```{r bin_data,fig.show='hide',include=FALSE}
<<bin_data>>  
```

* Bin Data
* Fix colors and legend
* Add country borders
* change projection
* applying a theme
* adding borders for Non-EU countries


```{r set_colors,message=FALSE,tidy=F,include=FALSE}
<<set_colors>>
```

```{r add_borders,message=FALSE,tidy=F,include=FALSE}
<<add_borders>>
```

```{r change_projection,message=FALSE,tidy=F,include=FALSE}
<<change_projection>>
```


## Some window dressing
```{r window_dressing,message=FALSE,tidy=F, include=TRUE}
<<window_dressing>>
```

```{r apply_theme,message=FALSE,tidy=F, include=TRUE}
<<apply_theme>>
```

## The final figure

```{r lastTouch, include=FALSE,cache=TRUE}
<<lastTouch>>
```

```{r final_plot,echo=FALSE}
<<final_plot>> 
```

EU 2013 Unemployment rates by NUTS2 regions, percentage of total population, both sexes Source: [Eurostat (tgs00010)](https://raw.githubusercontent.com/Tungurahua/R_examples/master/Example01/NUTS2choropletes_script.R)


# Concluding remarks

## Advantages of using R
* Reproducable work
* Unambiguous reference
* Re-using earlier work
* Workflow with early draft that is continuously refined
* Tight integraition wiht [git](https://github.com/Tungurahua/R_examples)
* Drivers for different output formats (jpg, svg, etc) all the way down to interactive javascript visualizations with [rCharts](http://rcharts.io/)
* Work without altering source data

## Discussion

Do we need this at Ecologic? What do you think?


